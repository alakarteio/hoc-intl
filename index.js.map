{"version":3,"file":"index.js","sources":["src/utils/storeSelector.js","src/utils/localeDataRegistry.js","src/utils/get.js","src/format.js","src/core.jsx","src/utils/wrapDisplayName.js"],"sourcesContent":["const getConfig = (field, mandatory = true) => (context) => {\n  const config = context.store\n    && context.store.getState()\n    && context.store.getState().config\n\n  if ((!config || !config[field]) && mandatory) {\n    throw new Error(`/HOC k-intl/ ${field} is not readable. Make sure that this one is available at config.${field} on your redux store`)\n  }\n  return config[field]\n}\n\nexport const getLocale = getConfig('locale')\nexport const getLang = getConfig('lang')\nexport const getFormats = getConfig('formats', false)\n","import IntlMessageFormat from 'intl-messageformat'\n\nexport default function (data) {\n  const localeDatas = [].concat(data)\n\n  localeDatas.forEach((localeData) => {\n    // eslint-disable-next-line no-underscore-dangle\n    if (localeData && localeData.locale) IntlMessageFormat.__addLocaleData(localeData)\n  })\n}\n","const get = (data, path) => path.split('.').reduce(\n  (curr, sub) => curr && curr[sub],\n  data,\n)\n\nexport default (data, path) => (typeof path === 'string' ? get(data, path) : data)\n","// eslint-disable-next-line import/no-unresolved, import/extensions\nimport defaultLocaleData from 'k-intl/locale-data/en'\nimport IntlMessageFormat from 'intl-messageformat'\nimport { addLocaleData, get } from './utils'\n\nconst defaultMessages = {}\nconst browserLanguage = window.navigator.language || window.navigator.browserLanguage\n/* add default locale on startup, import on src folder */\naddLocaleData(defaultLocaleData)\n\nexport const formatter = (...args) => new IntlMessageFormat(...args)\n\nconst formatMessage = (params, message = '', ...args) => {\n  if (params) {\n    try {\n      return formatter(message, ...args).format(params)\n    } catch (e) {\n      console.warn('/HOC k-intl/', e.message) // eslint-disable-line no-console\n    }\n  }\n  return message\n}\n\nconst getKey = (path) => {\n  const splitPath = path.split('.')\n  return splitPath[splitPath.length - 1]\n}\n\nconst getSubPaths = (locale, paths, config) => {\n  const subMessages = get(locale, paths)\n\n  if (!subMessages || typeof subMessages === 'string') {\n    return { [getKey(paths)]: paths }\n  }\n\n  return Object\n    .keys(subMessages)\n    .reduce(\n      (acc, curr) => ({ ...acc, [curr]: `${config}.${curr}` }),\n      defaultMessages,\n    )\n}\n\nexport default\n(lang = browserLanguage, locale, customFormats) => (config = {}, componentProps = []) => {\n  // in case of locale is not initialized\n  if (!locale) return {}\n\n  let paths = config\n  if (typeof paths === 'string') paths = getSubPaths(locale, paths, config)\n  return Object\n    .keys(paths)\n    .reduce((acc, curr) => {\n      const message = get(locale, paths[curr])\n      return { ...acc, [curr]: formatMessage(componentProps[curr], message, lang, customFormats) }\n    }, defaultMessages)\n}\n","import React, { Component } from 'react'\nimport shallowEqual from 'fbjs/lib/shallowEqual'\nimport { wrapDisplayName, getLocale, getLang, getFormats } from './utils'\nimport format from './format'\n\nexport default config => WrappedComponent => class extends Component {\n  static displayName = wrapDisplayName(WrappedComponent, 'Intl')\n\n  static contextTypes = {\n    store: () => null, // this is to avoid importing prop-types\n  }\n\n  constructor(props, context) {\n    super(props, context)\n    this.messages = {}\n    this.state = {\n      injectedProps: {},\n    }\n  }\n\n  componentWillMount() {\n    this.unsubscribe = this.context.store.subscribe(() => { this.inject() })\n    this.inject()\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.inject(nextProps)\n  }\n\n  componentWillUnmount() {\n    this.unsubscribe()\n  }\n\n  inject = (nextProps) => {\n    /* take locale on `config.lang` reducer */\n    const lang = getLang(this.context)\n    /* take locale on `config.locale` reducer */\n    const locale = getLocale(this.context)\n    /* take locale on `config.formats` reducer */\n    const formats = getFormats(this.context)\n\n    /* config can be a function, in which case we pass props to it */\n    let innerConfig = config\n    if (typeof config === 'function') innerConfig = config(nextProps || this.props)\n\n    /* format messages */\n    const messages = format(lang, locale, formats)(\n      innerConfig,\n      nextProps || this.props,\n    )\n    /* not change messages when the formated messages is identical */\n    if (shallowEqual(this.state.injectedProps.messages, messages)) return\n    this.setState(state => ({\n      ...state,\n      injectedProps: { messages },\n    }))\n  }\n\n  render() {\n    return (\n      <WrappedComponent\n        /* this is parent props */\n        {...this.props}\n        /* this is injected props from hoc */\n        {...this.state.injectedProps}\n      />\n    )\n  }\n}\n","export default (Component, wrapperName) => (\n  `${wrapperName || 'intl'} (${Component.displayName\n  || Component.name\n  || (Component.constructor && Component.constructor.name)\n  || 'Unknown'})`\n)\n"],"names":["getConfig","field","mandatory","context","config","store","getState","Error","getLocale","getLang","getFormats","data","concat","forEach","localeData","locale","IntlMessageFormat","__addLocaleData","path","split","reduce","curr","sub","defaultMessages","browserLanguage","window","navigator","language","addLocaleData","defaultLocaleData","formatMessage","params","message","args","format","e","console","warn","lang","customFormats","componentProps","paths","splitPath","subMessages","get","Object","keys","acc","length","WrappedComponent","Component","props","nextProps","_this","formats","innerConfig","messages","shallowEqual","state","injectedProps","setState","unsubscribe","this","subscribe","_this2","inject","React","displayName","name","constructor"],"mappings":"snBAAMA,EAAY,SAACC,OAAOC,oEAAqB,SAACC,OACxCC,EAASD,EAAQE,OAClBF,EAAQE,MAAMC,YACdH,EAAQE,MAAMC,WAAWF,YAExBA,IAAWA,EAAOH,KAAWC,QAC3B,IAAIK,6BAAsBN,8EAAyEA,kCAEpGG,EAAOH,KAGHO,EAAYR,EAAU,UACtBS,EAAUT,EAAU,QACpBU,EAAaV,EAAU,WAAW,cCXtBW,GACH,GAAGC,OAAOD,GAElBE,QAAQ,SAACC,GAEfA,GAAcA,EAAWC,QAAQC,EAAkBC,gBAAgBH,KCP3E,eAKgBH,EAAMO,SAA0B,iBAATA,GAL1BP,EAKkDA,EAAMO,EALpCC,MAAM,KAAKC,OAC1C,SAACC,EAAMC,UAAQD,GAAQA,EAAKC,IAC5BX,IAG2EA,EALjE,IAACA,GCKPY,EAAkB,GAClBC,EAAkBC,OAAOC,UAAUC,UAAYF,OAAOC,UAAUF,gBAEtEI,EAAcC,GAEP,IAEDC,EAAgB,SAACC,OAAQC,yDAAU,MACnCD,iCAD0CE,mCAAAA,2BAFvB,sCAAIA,2BAAAA,gDAAajB,EAAqBiB,kBAKxCD,UAAYC,IAAMC,OAAOH,GAC1C,MAAOI,GACPC,QAAQC,KAAK,eAAgBF,EAAEH,gBAG5BA,oBAwBRM,yDAAOd,EAAiBT,yCAAQwB,gDAAkB,eAACnC,yDAAS,GAAIoC,yDAAiB,OAE3EzB,EAAQ,MAAO,OAlBO0B,EAAOrC,EAJ5BsC,EAKAC,EAmBFF,EAAQrC,QACS,iBAAVqC,IArBuBrC,EAqBgCA,EApB5DuC,EAAcC,EAoB+B7B,EArBxB0B,EAqBgCA,GAA5BA,EAlB1BE,GAAsC,iBAAhBA,EAIpBE,OACJC,KAAKH,GACLvB,OACC,SAAC2B,EAAK1B,uCAAe0B,iCAAM1B,YAAUjB,cAAUiB,MAC/CE,mCAfEmB,EAQaD,EARItB,MAAM,MACZuB,EAAUM,OAAS,GAORP,IAkBrBI,OACJC,KAAKL,GACLrB,OAAO,SAAC2B,EAAK1B,OACNW,EAAUY,EAAI7B,EAAQ0B,EAAMpB,wCACtB0B,iCAAM1B,EAAOS,EAAcU,EAAenB,GAAOW,EAASM,EAAMC,MAC3EhB,wBClDQnB,UAAU,SAAA6C,WCLTC,oCDYFC,EAAOhD,2IACXgD,EAAOhD,mHAoBN,SAACiD,OAEFd,EAAO7B,EAAQ4C,EAAKlD,SAEpBY,EAASP,EAAU6C,EAAKlD,SAExBmD,EAAU5C,EAAW2C,EAAKlD,SAG5BoD,EAAcnD,EACI,mBAAXA,IAAuBmD,EAAcnD,EAAOgD,GAAaC,EAAKF,YAGnEK,EAAWtB,EAAOI,EAAMvB,EAAQuC,EAArBpB,CACfqB,EACAH,GAAaC,EAAKF,OAGhBM,EAAaJ,EAAKK,MAAMC,cAAcH,SAAUA,MAC/CI,SAAS,SAAAF,uCACTA,GACHC,cAAe,CAAEH,SAAAA,WAxCdA,SAAW,KACXE,MAAQ,CACXC,cAAe,+HAKZE,YAAcC,KAAK3D,QAAQE,MAAM0D,UAAU,WAAQC,EAAKC,gBACxDA,2DAGmBb,QACnBa,OAAOb,uDAIPS,sDA8BHK,gBAACjB,0BAEKa,KAAKX,MAELW,KAAKJ,MAAMC,uBA3DoCT,0DCL3CA,EDMuBD,YAAkB,oBCL1BC,EAAUiB,aACpCjB,EAAUkB,MACTlB,EAAUmB,aAAenB,EAAUmB,YAAYD,MAChD,8DDImB,CACpB/D,MAAO,kBAAM"}